\input{./../header/kib.tex}
\input{./../header/user.tex}  

% TODO ! напишите здесь название вашей лекции
\title{Лекция 2. Теория вероятности}
% TODO ! замените на дату проведения этой лекции. Например \date{14 апреля 2019}
\date{24.11.2023}
% \logo{\href{https://t.me/kibinfo}{\includegraphics[width=.05\textwidth]{./../pic/kib_logo.png}}}
\author{Слипенчук Павел Владимирович}
\institute{\centering \includegraphics[width=.2\textwidth]{./../pic/kib_logo.png} \\ Москва,\\ \href{https://t.me/kibinfo}{\textbf{КИБ}} }
% \titlegraphic{\href{https://t.me/kibinfo}{\includegraphics[width=.05\textwidth]{./../pic/kib_logo.png}}}

% TODO ! замените https://github.com/kib-courses/latex_templates на ссылку ВАШЕГО спецкурса!
\titlegraphic{\small \href{https://github.com/kib-courses/dsis-math-base}{Базовая математическая подготовка для Data Science}}

\begin{document}
  \maketitle
    
  \begin{frame}{План лекции}\label{frame:plan}
  	% TODO ! добавте в план все ваши секции, кроме "Вопросы для самопроверки", "Домашнее задание" и "Список материалов"
    \begin{enumerate}
	% \item \nameref{section:why_combinatorics}

	\item \nameref{section:probability}
	\item \nameref{section:presicion_and_recall}
	\item \nameref{section:Bayes}
	\item \nameref{section:probability_computation}
	
	\item \nameref{section:manipulations}

	\end{enumerate}
 \end{frame}

\begin{frame}{Важное замечание 1}
Лекция будет сильно упрощена, 
рассказана
<<на пальцах>>.

Задача: научится инженерно использовать теор.вероятности и не делать классических ошибок.

Мы не будем касаться определения теории вероятности по Колмогорову,
теорию меры,
$\sigma$-алгебру событий 
и т.д.
На это нет времени.

\end{frame}

\begin{frame}[fragile,t]{Важное замечание 2}
	
	\вопрос{Верно ли утверждение?:}
	\begin{equation*}
	a \cdot b = c ~\Longrightarrow~ a = \frac{c}{b}
	\end{equation*}
	
	
	
\end{frame}

\begin{frame}[fragile,t]{Важное замечание 2}
	
	\вопрос{Верно ли утверждение?:}
	\begin{equation*}
	a \cdot b = c ~\Longrightarrow~ a = \frac{c}{b}
	\end{equation*}
	
	Нет не верно!
	
	Правильно:
	\begin{equation*}
	a \cdot b = c ~\Longrightarrow~ a = \frac{c}{b} \vee \left( (b=0 \vee a=0  )\wedge c =0 \right)
	\end{equation*}
	
	Но... во всей лекции мы не будем такими занудами... :)
	
	
\end{frame}


    
  
%\section{Зачем нужна теория вероятности в DS}\label{section:why_probability}
%\begin{frame}
%Теорвер
%\begin{itemize}
%\item основа основ для конструирования экспертных систем (ЭС), 
%в частности ML алгоритмов.
%\item 
%\end{itemize}
%\end{frame}

\section{Вероятность. Априорная и апостариорная веростности. Задача Монти Холла. Условная вероятность. Правило сложения и суммы}\label{section:probability}

\begin{frame}{Вероятность}
	Есть некий процесс, который всегда заканчивается определённым исходом : $a_1, a_2, a_3 ..., a_{n-1}$ или $a_n$.
	Будем эти исходы называть \termdef{событиями}.
	
	\termdef{Вероятность [события]} $P(a_i)$ -- это действительное число, обладающее следующими свойствами:
\begin{enumerate}
	\item $\forall a_i \in \left\{a_1, ..., a_n \right\} ~\Longrightarrow~ P(a_i) \in [0, 1]$
	\item $\forall b \notin \left\{a_1, ..., a_n \right\} ~\Longrightarrow~ P(b) = 0$
	\item $\sum_{i=1}^{i=n}\left(P(a_i)\right) = 1$
\end{enumerate}


\textbf{Замечание.}
В данном определении нет физического смысла понятия 
<<вероятность>>. Это просто некие числа, 
<<прикреплённые>> к событиям.
Они могут оказатся <<адекватными>> (насколько?)
или <<не адекватными>>.

\end{frame}

\begin{frame}{Вероятность. (Доп.слайд для зануд)}
\footnotesize
Вообще-то любое множество ${a_1, ..., a_n}$  
можно дополнить любым ${c_1, ..., c_m}$, 
таким что:
\begin{equation*}
	 \forall c \in \left\{c_1, ..., c_m \right\} ~\Longrightarrow~ P(c) = 0
\end{equation*}

Например $\{a_1, a_2\}$ -- это события, 
что [не мошенническая] монетка
упадёт орлом или решкой. Тогда $P(a_1) = P(a_2) = \frac{1}{2}$.

Мы можем дополнить событиями:
\begin{itemize}
	\item $c_1$ -- событие, что монета упадёт ребром;
	\item $c_2$ -- событие, что монета прилипнет к потолку;
	\item $c_3$ -- событие, что монета улетит в открытый космос и вообще не упадёт;
	\item ... \вопрос{ещё примеры?}
\end{itemize}

По этой причине первую формулу лучше определять не так:
\begin{equation*}
 \forall a_i \in \left\{a_1, ..., a_n \right\} ~\Longrightarrow~ P(a_i) \in [0, 1]
\end{equation*}
а так:
\begin{equation*}
\forall a_i \in \left\{a_1, ..., a_n \right\} ~\Longrightarrow~ P(a_i) \in (0, 1]
\end{equation*}

\end{frame}


\begin{frame}{Равновероятные события}
	\small
	
	События  $a_1, ..., a_n$ равновероятны по определению, если:
	\begin{equation}
	P(a_1) = P(a_2) = ... = P(a_n)
	\end{equation}
	
	\дз{Докажите, что для равновероятных событий:}
	\begin{equation}
	\forall a_i \in \left\{a_1, ..., a_n \right\} ~\Longrightarrow~ P(a_i) = \frac{1}{n}
	\end{equation}
	
	Примеры равновероятных событий:
	\begin{itemize}
		\item выпадение орла или решки на монете (не мошеннической)
		\item зачатие\footnote{Не рождения. Например в Китае во время политики <<одна семья -- один ребёнок>> рождалось больше мальчиков. Почему?} мальчика или девочки, если зачат один ребёнок
		\item выпадение 1, 2, 3, 4, 5 или 6 на игральном кубике (не мошенническом)
		\item \вопрос{ещё?}
	\end{itemize}
	
\end{frame}


\begin{frame}{Априорная вероятность}
	
	\termdef{Априорная вероятность} -- число от 0 до 1, взятое из каких-либо умозаключений или правил.
	Примеры:
	\begin{enumerate}
		\item Вероятность выпадения орла 0.5, потому что он ничем не лучше и не хуже решки и монетка не может упасть ребром (это пренебрежимо мало)
		\item Мы отправили \term{событие} на вход экспертной системы (ЭС) и получили на выходе решение: "вероятность мошенничества равна 0.7 для данного события".
	\end{enumerate}
	
\end{frame}

\begin{frame}{Апостериорная вероятность}
	\small
	\termdef{Апостериорная вероятность} -- статистическая величина\footnote{
		Вообще то говоря, апостериорная вероятность имеет более глубокий и широкий смысл.
		Но в рамках нашего курса апостериорная вероятность -- это просто статистическая доля того или иного события.}, посчитанная на каких-либо конкретных данных.
	
	Примеры: 
	\footnotesize
	\begin{enumerate}
		\item Мы 100 раз подбросили монету и 47 раз выпал орёл. Следовательно 
		вероятность выпадения орла 0.47
		\item Мы взяли экспертную систему и посчитали, что \term{решение} "вероятность мошенничества 0.7"
		выпало на 67 мошеннических и 34 легитимных операций за определённое время. 
		Значит \term{точность} системы для данного \term{решения} на данном промежутке времени равна $\frac{67}{67+34} \approx 0.66$; что примерно равно $0.7$ -- следовательно систему можно считать адекватной.
	\end{enumerate}
\end{frame}


%\begin{frame}{Неразделение априорной и апостариорной вероятности}
%	А.Шень:
%	<<Вероятностью называется отношение числа благоприятных исходов к общему числу равновозможных исходов.>>
%	\begin{enumerate}
%		\item Какова вероятность ядерной войны?
%		\item Какова вероятность ядерной зимы при ядерной войне?
%		\item Какова была вероятность победы Третьего рейха над СССР?
%		\item ...
%	\end{enumerate}
%\end{frame}


\begin{frame}{Совместные и несовместные события}


$P(AB)$ -- вероятность того, что произойдёт и А и B одновременно
(Так же обозначают как $P(A \wedge B)$, иногда $P(A\bigcap B)$)

%\includegraphics[width=0.4\textwidth]{./../pic/pAB_diargramm.drawio.png}

\begin{itemize}
	\item $A$ и $B$ -- \termdef{совместные события}, если $P(AB) > 0$
	\item $A$ и $B$ -- \termdef{несовместные события}, если $P(AB) = 0$
\end{itemize}

\end{frame}

\begin{frame}{Задача Монти Холла (о двух козах и автомобиле)}
\footnotesize

Вам предлагают поиграть в игру. Есть три двери. За двумя -- по козе, за одной -- автомобиль. 
Номер двери автомобиля определяется случайно ($P(A_1)=P(A_2)=P(A_3)=\frac{1}{3})$)

Вы выбираете одну из дверей. 
Ведущий, не показывая вам, смотрит в эту дверь. После:
\begin{itemize}
	\item если за выбранной вами дверью коза, ведущий открывает ДРУГУЮ дверь, где коза.
	\item если за выбранной вами дверью автомобиль, ведущий открывает ДРУГУЮ дверь наугад (и там коза).
\end{itemize}
Таким образом перед вами всегда открывают не вашу дверь и там всегда коза.
После этого по правилам игры у вас есть выбор:
\begin{enumerate}
	\item оставить выбранную дверь и открыть её, забрав приз (козу или автомобиль);
	\item изменить первый выбор и получить приз из другой двери.
\end{enumerate}

\вопрос{При каком выборе вероятность выиграть автомобиль больше? }
	
\end{frame}


\begin{frame}{Задача Монти Холла (о двух козах и автомобиле)}

Введём события:
\begin{itemize}
	\item $B_1$ -- вы вначале выбрали первую дверь
	\item $B_2$ -- вы вначале выбрали вторую дверь
	\item $B_3$ -- вы вначале выбрали третью дверь
\end{itemize}

Вы -- не Кассандра, поэтому события $A_i$ и $B_j$ -- \term{независимые}.


Так же не имеет смысл думать какую именно дверь выбирать.
Следовательно:
\begin{equation}\label{eq:B_pofig}
P(B_1) = P(B_2) = P(B_3) = \frac{1}{3}
\end{equation}

Следовательно:
\begin{equation*}
\forall i \in \{1,2,3\}, \forall j \in \{1,2,3\} ~\Longrightarrow~ P(A_i B_j) = P(A_i) \cdot P(B_j) = \frac{1}{3} \cdot \frac{1}{3}=\frac{1}{9}
\end{equation*}

...
\end{frame}
\begin{frame}
...

Рассмотрим вероятность выигрыша при стратегии не менять выбранную дверь ($S_1$) и стратегию её изменить $S_2$.
Вероятность выигрыша для этих стратегий обозначим $P(S_1)$ и $P(S_2)$ соотвественно.

Тогда верно:
\begin{equation}
P(S_1) =  \sum_{i=j} P(A_i B_i) = \sum_{i=j} P(A_i)\cdot P(B_i) = 3 \frac{1}{9} = \frac{1}{3}
\end{equation}
\begin{equation}
P(S_2) =  \sum_{i \neq j} P(A_i B_i) = \sum_{i \neq j} P(A_i)\cdot P(B_i) = 3 \cdot 2 \cdot \frac{1}{9} = \frac{2}{3}
\end{equation}

	
\дз{На самом деле утверждение \eqref{eq:B_pofig} не очевидно... Докажите, что даже если $P(B_i)$ различаются,
мы всё равно получим те же $P(S_1)$ и $P(S_2)$: при смене двери вероятность выиграть автомобиль в два раза больше.}
\end{frame}


\begin{frame}{Условная вероятность}

$P(A|B)$ -- вероятность того, что произойдёт $A$, при условии что уже произошло $B$

$P(B|A)$ -- вероятность того, что произойдёт $B$, при условии, что уже произошло $A$

\дз{ДЗ. Почему верны формулы?:}
\begin{equation}\label{eq:P_A_by_B}
P(A|B) = \frac{P(AB)}{P(B)}
\end{equation}
\begin{equation}\label{eq:P_B_by_A}
P(B|A) = \frac{P(AB)}{P(A)}
\end{equation}

	
\end{frame}

\begin{frame}{Независимые события}
	
События $A$ и $B$ независимы, если 
наступление события $A$ никак не влияет на вероятность $B$,
а наступление события $B$ никак не влияет на $A$;
т.е на языке математики:
\begin{equation*}
P(A|B) = P(A)
\end{equation*}
\begin{equation*}
P(B|A) = P(B)
\end{equation*}

Для \textbf{независимых} событий из формул 
\eqref{eq:P_A_by_B} и \eqref{eq:P_B_by_A}
верно:
\begin{equation}\label{eq:P_AB_P_A_P_B}
P(AB) = P(A) \cdot P(B)
\end{equation}

\дз{ДЗ. Докажите \eqref{eq:P_AB_P_A_P_B}, используя определение независимых событий и формулы 
\eqref{eq:P_A_by_B} и \eqref{eq:P_B_by_A}
}

%\includegraphics[width=0.4\textwidth]{./../pic/pApB_independet_diargramm.drawio.png}

\end{frame}




\begin{frame}{Правило суммы и правило сложения}

 \termdef{Правило суммы}. Если $A$ и $B$ \term{несовместные} события, 
 то тогда вероятность того, что произойдёт хотя бы одно из событий:
 \begin{equation}\label{eq:rule_summ}
 P(A \vee B) = P(A) + P(B)
 \end{equation}

 \termdef{Правило умножения}. Если $A$ и $B$ \term{независимые} события, 
 то тогда вероятность того, что произойдёт хотя бы одно из событий:
 \begin{equation}\label{eq:rule_cdot}
 P(A B) = P(A) \cdot P(B)
 \end{equation}
 
 %\дз{ДЗ. Почему формулы \eqref{eq:rule_summ} и \eqref{eq:rule_cdot} верны?}

\end{frame}

\begin{frame}{Вопросы на засыпку}
\дз{Подумайте дома, разбирая эту лекцию.}

Назовём \underline{три} события $A$, $B$, $C$ независимыми, если:
\begin{equation}
P (A B C) = P(A) \cdot P(B) \cdot P(C)
\end{equation}

Верны ли утверждения?
\begin{enumerate}
	\item Если $A$, $B$, $C$ -- независимы, то они все пары из них -- независимы
	\item Если $A$, $B$, $C$ -- независимы, то есть хотя бы одна пара независимых событий
	\item Если любая пара из ${A, B, C}$ -- независимы, то все три $A, B, C$ -- независимы.
\end{enumerate}

\end{frame}

\section{Ложная сработка, пропуск цели, полнота и точность}\label{section:presicion_and_recall}


\begin{frame}{События и события экспертной системы}
\footnotesize
Рассмотрим на примере детектирования 
мошенничества в Онлайн банкинге.

Варианты событий для каждой банковской транзакции:
\begin{itemize}
	\item $L_r$ (legitim real) -- событие, означающее что банковская операция в действительности является легитимной (не мошеннической).
	\item $F_r$ (fraud real) -- событие, означающее что банковская операция в действительности является мошеннической. 
	\item $L_s$ (legitim system) -- событие когда анализируемая нами система фрод-мониторинга оценила данную операцию как легитимную (не мошеннической).
	\item $F_s$ (fraud system) -- событие, когда анализируемая нами система фрод-мониторинга оценила данную операцию как мошенническую.
\end{itemize}

\вопрос{какие события 
	\term{несовместные},
	а какие \term{совместные}?
}
\end{frame}

\begin{frame}

Таким образом можно рассматривать следующие события: 
\begin{itemize}
	\item $P(L_r L_s)$,
	\item $P(F_r L_s)$, 
	\item $P(L_r F_s)$,
	\item $P(F_r  F_s)$.
	.
\end{itemize}

\вопрос{Какая из этих вероятностей наибольшая и максимально близка к 1?}

\вопрос{Предположим, что у нас
	<<идеальная>> система фрод-мониторинга -- то есть которая никогда не ошибается. Какие вероятности равны нулю?}

\end{frame}

  \begin{frame}{Ложная сработка \& пропуск цели} 
	\begin{center}
		\LARGE
		\begin{tabular}{l|l}
			Ошибка I рода & Ошибка II рода \\
			$\alpha$ ошибка & $\beta$ ошибка \\
			false positive (fp) & false negative (fn) \\ 
			Ложная сработка  & Пропуск цели \\
			$P(L_r|F_s)$ & $P(F_r |L_s)$\\
		\end{tabular}
	\end{center}
	
	\begin{block}{Замечание.}
		Иногда false positive называют событие $P(L_r F_s)$, а не $P(L_r | F_s)$.
		Аналогично false negative называют $P(F_r  L_s)$, а не $P(F_r | L_s)$.
		Это очень важно! Не запутайтесь!
	\end{block}
\end{frame}



\begin{frame}{Полнота \& точность}\label{frame:presicion_recall}
	\small
	Основными показателями качества системы являются 
	\termdef{полнота} ($\Pi$, \termdef{recall}) 
	и 
	\termdef{точность} ($\boldsymbol T$, \termdef{precision}).
	
	Их определения:
	\begin{equation}\label{eq:recall_def}
	\Pi \stackrel{def}{=} P(F_s | F_r)
	\end{equation}
	\begin{equation}\label{eq:precision_def}
	\boldsymbol T \stackrel{def}{=} P(F_r | F_s)
	\end{equation}
	
	Полноту и точность можно вычислить через формулы:
	\begin{equation}\label{eq:recall_calc}
	\Pi = \frac{P(F_s  F_r)}{P(F_s F_r) + P(L_s F_r)}
	\end{equation}
	\begin{equation}\label{eq:precision_calc}
	\boldsymbol T = \frac{P(F_s F_r)}{P(F_s F_r) + P(F_s L_r)}
	\end{equation}
	\дз{ДЗ: докажите эти формулы.}
	
	\дз{ДЗ: посмотрите  \ссылка{https://en.wikipedia.org/wiki/Precision_and_recall}{определения в англоязычной Википедии} $\boldsymbol T$ и $\Pi$.}
\end{frame}


\begin{frame}{Использование формул \eqref{eq:recall_calc} и \eqref{eq:precision_calc}}\label{frame:precision_calc_example}
	\footnotesize
	Формулы \eqref{eq:recall_calc} и \eqref{eq:precision_calc} полезны 
	для определения полноты и точности через статистические данные.
	
	Введём обозначение: $C(AB)$ -- это количество раз, когда произошли события $A$ и $B$ одновременно.
	
	Предположим, что в каком-либо банке за определенный промежуток времени
	произошло \textbf{562} мошеннических транзакций. 
	Выберем их все и случайным способом ещё \textbf{100 000} легитимных транзакций.
	Предположим что всего за этот промежуток произошло \textbf{67 234 134 234} операций. 
	
	Тогда наша выборка легитимных операций это $1/q$ от общей доли, где: 
	\begin{equation*}
	q = \frac{67234134234}{100000} \approx 672 \cdot 10^3
	\end{equation*}
	
	Мы прогнали все эти транзакции через экспертную систему (ЭС) [обнаружения мошенничества] и получили:
	$C(F_s F_r)= 386$, 
	$C(F_s L_r)= 18$, 
	$C(L_s F_r)= 176$, 
	$C(L_s L_r)= 999 982$.
	
	... ... ... ...
\end{frame}

\begin{frame}{Использование формул \eqref{eq:recall_calc} и \eqref{eq:precision_calc}} 
	... ... ... ...
	
	Таким образом через формулу  \eqref{eq:precision_calc} можно найти точность:
	\begin{eqnarray*}
		T = \frac{P(F_s F_r)}{P(F_s F_r) + P(F_s L_r )} = 
		\frac{C(F_s F_r)}{C(F_s F_r) + q \cdot C(F_s L_r)}  = \\
		\approx \frac{386}{386 + 18 \cdot  672 \cdot 10^3 }
		\approx \frac{386}{18 \cdot  672 \cdot 10^3 }
		\approx 3 \cdot 10^{-5}
	\end{eqnarray*}
	
	\begin{block}{Замечание}
		Очень часто при подсчёте точности забывают про коэффициент $q$ 
		и совершают ошибку, измеряя точность на конкретных данных.
		На практике физически невозможно выбрать все легитимные транзакции,
		поэтому берут их подмножество.
	\end{block}
	
	\дз{ДЗ: найдите полноту. Зависит ти она от $q$?}
\end{frame}

\begin{frame}{$O_1$ и $O_2$ через $\Pi$ и $T$}
	Ошибки I и II рода ($O_1$ и $O_2$)
	можно выразить через полноту и точность.
	
	\begin{equation}\label{eq:O_2_from_recall}
	O_2 = 1 - \Pi
	\end{equation}
	
	\begin{equation}\label{eq:O_1_from_recall_and_presicion}
	O_1 = \frac{P(F_r)}{P(L_r)} \cdot \Pi \cdot \left( \frac{1}{T} - 1 \right)
	\end{equation}
	
	\дз{ДЗ. Докажите формулы 
		\eqref{eq:O_2_from_recall}
		и
		\eqref{eq:O_1_from_recall_and_presicion}
	}
	
	\дз{ДЗ. Выразите полноту и точность, через $O_1$ и $O_2$}
	
\end{frame}




\section{Формула Байеса}\label{section:Bayes}

\begin{frame}
\textbf{То́мас Ба́йес}
(Thomas Bayes; \textbf{1702 -- 1761}) 
— английский математик, священник. 
Член Лондонского королевского общества.
	
\begin{equation}\label{eq:Bayes}
P(A|B) = \frac{P(B|A) \cdot P(A)}{P(B)}
\end{equation}

$\blacktriangleleft$
Из формул \eqref{eq:P_A_by_B} и \eqref{eq:P_B_by_A}
получаем:
\begin{equation*}
P(A|B)P(B) = P(AB) = P(B|A) P(A)
\end{equation*}
откуда получаем \eqref{eq:Bayes}.
$\blacktriangleright$


\end{frame}




\section{Рассчёт случайных величин}\label{section:probability_computation}

\begin{frame}
	В практике DSIS мы почти всегда рассчитываем случайные величины как 
	\term{апостериорные вероятности}
	и выдаём их заказчику как <<чёрный ящик>>. То есть для заказчика они \term{aприорные вероятности}.
	
	Основная цель -- это мера адекватности системы. Этому будет посвящён курс FE\&ML.
	
	Рассмотрим несколько проблем при рассчёте апостериорных вероятностей
\end{frame}

\begin{frame}{Фундаментальные свойства апостериорных вероятностей}
	Все апостериорные вероятности рассчитываются на некоторой выборке данных.
	
	Выборка может оказаться не репрезентативной:
	\begin{enumerate}
		\item устаревшей,
		\item собранной для решения ДРУГОЙ задачи,
		\item содержащая в себе скрытое коррелирующее событие (след.слайд).
	\end{enumerate}

\дз{ДЗ. Вспомните какие примеры говорили про каждый пункт. Напишите в тетради кратко, чтобы не забыть.}

\end{frame}

\begin{frame}{Психологический тест с зефирками}
	Тезисно (\дз{дома посмотрите})
	\begin{itemize}
		\item 1970 год -- исследование Уолтера Мишеля в Стенфорде
		\item Анализ жизни бывших детей в 1988 и 1990
		\item 2018 -- опровержение Тайлера Уотса
	\end{itemize}
	
	<устно на лекции>	
\end{frame}

\begin{frame}{От исследования к истине}
	\вопрос{А как быть уверенным, что в нашем исследовании <<всё чисто>> и выборка репрезентативна?
	Как не ошибиться?}
\end{frame}

\begin{frame}{От исследования к истине}
	\footnotesize
	Из курса КИБ по критическому мышлению.
	
	\textbf{Первый парадокс веры.} -- мы очень много верим.
	На языке текущей лекции -- многие вещи воспринимаем априорно. Нет времени и\\или возможности всё перепроверять
	
	\textbf{Второй парадокс веры.} -- мы верим в корректную интерпретацию опыта, в переход "опыт -> знание".
	Однако, в действительности, этот переход обусловлен нашим воспитанием, образованием, религией, интуицией и более ранним опытом.
	На языке статистики -- корреляция переходит в знание благодаря... вере.
	
	\textbf{Третий парадокс веры.} -- мы сами определяем границу достаточного накопления знаний, для перехода "опыт -> знание". 
	На языке статистики -- какая выборка достаточно большая? 
	
	Итог: в конечном итоге любое научное знание обусловлено... верой в него.
\end{frame}


\begin{frame}{Маргарин и разводы...}
	  \includegraphics[width=10cm]{../pic/rate_in_Maine.png}
	  \вопрос{Влияет ли потребление маргарина на число разводов в штате Мэн ?}
	  
	  Источник: \ссылка{https://tylervigen.com/spurious-correlations}{Tyler Vigen}
\end{frame}



\begin{frame}[fragile,t]{Парадокс Юла-Симпсона (парадокс объединения)}
	\вопрос{
		На некотором предприятии выяснили, что среди всех кандидатов на работу, 
		среди мужчин взяли 53.5\%,
		а среди женщин взяли 18.5\%.
		Верно ли, что существует <<гендерная дискредитация>> женщин?
	}
	
\end{frame}

\begin{frame}[fragile,t]{Парадокс Юла-Симпсона (парадокс объединения)}
\вопрос{
	На некотором предприятии выяснили, что среди всех кандидатов на работу, 
		среди мужчин взяли 53.5\%,
		а среди женщин взяли 18.5\%.
	Верно ли, что существует <<гендерная дискредитация>> женщин?
}

\begin{table}[] % https://tablesgenerator.com/
	\footnotesize
	\begin{tabular}{|l|l|ll|ll|ll|}
		\hline
		отдел & вакансий & \multicolumn{2}{l|}{кандидаты} & \multicolumn{2}{l|}{принято } & \multicolumn{2}{l|}{\% принятых} \\ \cline{3-8} 
		&                                      & \multicolumn{1}{l|}{М}   & Ж   & \multicolumn{1}{l|}{М}        & Ж      & \multicolumn{1}{l|}{М}         & Ж         \\ \hline
		продажи                & 30                                   & \multicolumn{1}{l|}{25}  & 100 & \multicolumn{1}{l|}{5}        & 25     & \multicolumn{1}{l|}{20\%}      & 25\%      \\ \hline
		монтаж                 & 200                                  & \multicolumn{1}{l|}{250} & 25  & \multicolumn{1}{l|}{180}      & 20     & \multicolumn{1}{l|}{72\%}      & 80\%      \\ \hline
		склад                  & 20                                   & \multicolumn{1}{l|}{80}  & 200 & \multicolumn{1}{l|}{5}        & 15     & \multicolumn{1}{l|}{6.25\%}    & 7.5\%     \\ \hline
		ИТОГО                  & 250                                  & \multicolumn{1}{l|}{355} & 325 & \multicolumn{1}{l|}{190}      & 16     & \multicolumn{1}{l|}{53.5\%}    & 18.5\%    \\ \hline
	\end{tabular}
\end{table}


Ответ: наоборот, <<дискредитируют>> \textbf{мужчин}, а не женщин...
\end{frame}

% \begin{section}{Out of scope}	
%\begin{frame}
%	В рамках старта DSIS нам это 99\% 
%	не пригодится.
%	
%	\внекурса{Однако чтобы не быть обезъяной нужно постепенно освоить эти темы (вне курса).}
%	\begin{enumerate}
%		\item 
%	\end{enumerate}
%	
%	На \textbf{фундаментальные} знания потребуются, но не на старте.	
% \end{frame}
% \end{section}


\section{Манипуляции в теории вероятности}\label{section:manipulations}

\begin{frame}{Семантические манипуляции}
\small
	Суть в различных интерпритациях условий задачи.
	
	Например \ссылка{https://ru.wikipedia.org/wiki/Парадокс_мальчика_и_девочки}{парадокс мальчика и девочки} (парадокс детей мистера Смита):
\begin{center}
	\textit{
	<<У мистера Смита двое детей. Хотя бы один ребёнок -- мальчик. Какова вероятность того, что оба ребёнка -- мальчики?>>
}
\end{center}

Ответ $p$ зависит от интерпретаций:
\begin{itemize}
	\item Из всех семей с двумя детьми, где хотя бы один мальчик, выбрана произвольная семья. В этом случае ответ $p=1/3$.
	\item Из всех семей с двумя детьми один ребёнок выбирается случайным образом, и пол этого ребёнка сообщается 
	(т.е. говорится либо «хотя бы один ребёнок — мальчик», либо «хотя бы один ребёнок — девочка»). В этом случае ответ $p=1/2$.
\end{itemize}

\end{frame}

\begin{frame}{Общие метанаучные вопросы без определения пространства событий}
	Мы сначала определяем пространство событий и только потом можем говорить о теории вероятности.
	Но как именно определить это пространство?
	
	Порой задача определения этого пространства -- очень сложна.
\begin{enumerate}
	\item Какова вероятность того, что жизнь появится на планете?
	\item Какова вероятность того, что США будет воевать с Китаем в 2028 году?
	\item \вопрос{ещё примеры}
\end{enumerate}
	
\end{frame}

\begin{frame}{Задача о двух конвертах}

Есть два конверта с деньгами.
В один конверт помещают какую-то сумму денег,
сколько именно -- не известно. 
Во второй -- в два раза больше.

Вам и вашему партнёру дали по конверту, 
выбор конвертов происходил равновероятно.

Вы открыли конверт и обнаружили в нём X рублей.
Сколько у вашего партнёра -- вам не известно.

\вопрос{Выгодно ли вам с ним поменятся?}


\end{frame}

\begin{frame}{Задача о двух конвертах. Наивное решение}

У вашего партнёра либо 2X рублей, либо
$\frac{X}{2}$ рублей. Эти исходы равновероятны.

Следовательно если вы обменяете конверты, то в среднем получите:
\begin{equation}\label{eq:envelopes}
	\frac{1}{2}\cdot2X + \frac{1}{2}\cdot\frac{X}{2}=\frac{5}{4}X	 > X
\end{equation}

Но ведь и ваш партнёр думает так же! 
Следовательно вам обоим ВЫГОДНО поменять конверт.
Но так быть не может.

Где ошибка в формуле \eqref{eq:envelopes}?
\end{frame}

\begin{frame}{Задача о двух конвертах. Манипуляция}

Манипуляция: 
<<В один конверт помещают какую-то сумму денег,
сколько именно -- не известно.>>

В мире напечатано очень много, но ОГРАНИЧЕННОЕ 
количество денег.
Их не может быть бесконечно много.

На самом деле, кроме вас и партнёра есть ещё спонсор.
Наколько этот он богат?
Он не может быть <<бесконечно богатым>>.

На языке математики: вы не задали множество $A$:
\begin{equation}
A = \{ a_1, a_2, ... , a_n\},
\end{equation}
где $a_i$ -- это какая-то сумма денег (в рублях, долларах, лирах и т.д.), которую спонсор берёт для ОБОИХ конвертов.

(...)
\end{frame}

\begin{frame}{Задача о двух конвертах. Решение}
\small
(...)

Правильно написать так:
спонсор для обоих конвертов с вероятностью $P(a_i)$ берёт $a_i$ денег,
тогда верно
\begin{equation}
\sum_{\forall i=1}^{i=n} P(a_i) = 1
\end{equation}

Максимальная сумма денег у спонсора: $max \left( \{ P(a_i) \}_{i=1,~...~,~n} \right)$

Тогда в первом конверте с вероятностью $P(a_i)$ имеем $\frac{1}{3} a_i$ денег,
а во втором $\frac{2}{3} a_i$ денег.
\дз{Можем построить соотвествующие графики для обоих конвертов.}


Если у вас $X$ денег,
вы должны посмотреть на графики (домашнее задание)
и вычислить выгоду.

\дз{
В качестве домашнего задания. Пусть $a_i$ c шагом в 300 рублей равновероятно может быть 300, 600, ..., 30000.
Решите задачу, написав код на Python}
	



\end{frame}

\begin{frame}[fragile,t]{Криминальная статистика и этнический фактор}
\footnotesize
Согласно данным, <<лица кавказкой национальности>> в 2023 году совершили 
в $q$ раз больше преступлений, чем в 2022 году.

\вопрос{Верно ли, что встретив <<лицо кавказкой национальности>>
мы должны в $q$ раз быть <<более осторожными>>?}
	
	
\end{frame}


\begin{frame}[fragile,t]{Криминальная статистика и этнический фактор}
\footnotesize
Согласно данным, <<лица кавказкой национальности>> в 2023 году совершили 
в $q$ раз больше преступлений, чем в 2022 году.

\вопрос{Верно ли, что встретив <<лицо кавказкой национальности>>
	мы должны в $q$ раз быть <<более осторожными>>?}
	
Для каждого человека возможны два события:
\begin{itemize}
	\item E (evel) -- человек является преступником;
	\item С (Caucasus) -- человек <<лицо кавказкой национальности>>.
\end{itemize}

На языке математики нам сообщили следующее:
\begin{equation}
P_{2023}(C|E) = q \cdot P_{2022}(C|E)
\end{equation}

Но встретив <<лицо кавказкой национальности>> мы должны оценивать 
не $P_{2023}(C|E)$, а $P_{2023}(E|C)$ !!!

\дз{ДЗ. Раскройте по формуле Байеса и найдите условия роста $P_{2023}(E|C)$.}
	
\end{frame}


\section{Домашняя работа}


\begin{frame}{Что почитать}

\textbf{Методичка.} Для программистов и инженеров простое, быстрое и не вульгарное это: 
\begin{center}
	\ссылка{https://old.mccme.ru/free-books/shen/shen-probability.pdf}{
		Александр Шень
		<<Вероятность: примеры и задачи.>>}
\end{center}

\footnotesize
Прочитать неспешно
(можно по одному расслабленному вечеру на пункт)
\begin{enumerate}
	\item \ссылка{https://ru.wikipedia.org/wiki/История_теории_вероятностей}{История теории вероятности}
	\item \ссылка{https://habr.com/ru/articles/340048/}{Почему DataScientist-ы не используют ошибки $O_1$ и $O_2$}
	\item \ссылка{https://ru.wikipedia.org/wiki/Парадокс_дней_рождения}{Парадокс дней рождения}
	%\item \ссылка{https://ru.wikipedia.org/wiki/Парадокс_мальчика_и_девочки}{Парадокс мальчика и девочки} (Дети мистера Смита)
	%\item 
\end{enumerate}

\end{frame}



\begin{frame}{Ещё раз про определение полноты и точности}
	
	Определения полноты и точности задаются формулами  \eqref{eq:recall_def} и \eqref{eq:precision_def}.
	
	А формулы \eqref{eq:recall_calc} и \eqref{eq:precision_calc}
	доказываются.
	
	Что будет, если поступить наоборот? 
	Пусть \eqref{eq:recall_calc} и \eqref{eq:precision_calc} -- будут определениями
	полноты и точности. 
	Докажите тогда  \eqref{eq:recall_def} и \eqref{eq:precision_def}.
	
	С точки зрения математики -- всё равно как определять.
	
	Но исчезнет ли физический смысл? Разумно ли это?
	
\end{frame}


\begin{frame}{Санкт-Петербургский парадокс}
	\footnotesize
	Представьте, что вам предложили поиграть в игру.
	Для того чтобы начать в неё играть, вы должны заплатить $X$ рублей, один раз.
	
	Алгоритм игры:
	\begin{enumerate}
		\item Изначальны выигрыш один рубль: $V:=1$
		\item Выигрыш увеличивается в два раза: $V:=V \cdot 2$.
		\item Подбрасывется монетка.
		\begin{enumerate}
			 \item если решка, то goto 2
			 \item если орёл, то следующий шаг.
		\end{enumerate}  
		\item Вы выиграли $V$ рублей. Игра окончена
	\end{enumerate} 
	
	\textbf{Вопрос:} при каком входном взносе $X$ выгодно играть в эту игру?
	
	\textbf{Решение.} Давайте найдём математическое ожидание выигрыша:
	\begin{equation}
	M = \frac{1}{2} \cdot 2 + \frac{1}{4} \cdot 4 + \frac{1}{8} \cdot 8 + ... + \frac{1}{2^n} \cdot 2^n + ... = 1 + 1 + 1 + 1 + ... = + \infty
	\end{equation}
	
	Следовательно игра выгодна при любой сколь угодно большой ставки $X$.
	Но этого не может быть! В чём подвох?
	
	
\end{frame}


%\begin{frame}{<<Инвалид1ные задачки>>}
%	\textbf{Задача А}
%	Введём определение.
%	Событие $A$ <<полунезависимо>> к $B$, если:
%	\begin{equation}
%	P(A|B) = P(A)
%	\end{equation}
%	
%	Может ли быть так, чтобы $P(B|A) \neq P(B)$ ? Приведите пример или докажите, что так не может быть.
%	
%	\textbf{Задача Б}. Пусть $A$, $B$, $C$ -- независимы и частично независимы попарно: $A$ и $B$, $A$ и $C$. 
%	Возможа ли ситуация, чтобы $P(BC) \neq P(B) \cdot P(C)$. Приведите пример или докажите, что так не может быть.
%	
%	\textbf{Задача В.} Пусть $P(ABCD) = P(A) \cdot P(B) \cdot P(C) \cdot P(D)$. Пусть так же $A$, $B$, $C$, $D$ -- независимы попарно.
%	Возможна ли ситуация, чтобы $P(ABC) \neq P(A) \cdot P(B) \cdot P(C)$. Приведите пример или докажите, что так не может быть.
%	
%\end{frame}


  
\end{document}